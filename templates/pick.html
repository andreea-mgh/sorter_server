<div id="container_1" style="display:none;">
<h1>Categorizare manuală:</h1>
<img src="{{ image_url }}" id="preview" width="300"><br><br>

<form id="pickForm">
<label>Număr:</label>
<input type="radio" id="cat1" name="number" value="1" required>
<label for="cat1">Categoria 1</label>
<input type="radio" id="cat2" name="number" value="2">
<label for="cat2">Categoria 2</label>
<input type="radio" id="cat3" name="number" value="3">
<label for="cat3">Categoria 3</label>
<input type="radio" id="invalid" name="number" value="0">
<label for="invalid">Obiect invalid</label>
<br>
<input type="submit" value="Trimite">
</form>

<p id="status"></p>
</div>

<div id="container_2" style="display:block;">
    <p>Nu necesită intervenție.</p>
</div>

<script>
    async function checkForNewImage() {
    let res = await fetch("/result");
    let data = await res.json();

    if (data.status === "user_input") {
        // Force reload image if it's updated
        document.getElementById("preview").src = "{{ image_url }}?ts=" + Date.now();
        document.getElementById("container_1").style.display = "block";
        document.getElementById("container_2").style.display = "none";
    }
    else {
        document.getElementById("container_1").style.display = "none";
        document.getElementById("container_2").style.display = "block";
    }
}


setInterval(checkForNewImage, 2000); // poll every 2s

document.getElementById("pickForm").addEventListener("submit", async function(e) {
    e.preventDefault();  // stop normal form redirect

    let formData = new FormData(this);

    let response = await fetch("/answer", {
        method: "POST",
        body: formData
    });

    let text = await response.text();
    document.getElementById("status").innerText = text;
});
</script>